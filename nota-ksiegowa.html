<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Noty Ksiƒôgowej - FedEx</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #fff;
        }

        .container { max-width: 900px; margin: 0 auto; }

        header { text-align: center; margin-bottom: 40px; }
        header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        header p { color: #888; }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #4fc3f7;
            text-decoration: none;
        }
        .back-link:hover { text-decoration: underline; }

        .form-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
        }
        .form-card h2 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-row.single { grid-template-columns: 1fr; }

        .form-group { display: flex; flex-direction: column; }
        .form-group label {
            color: #aaa;
            font-size: 0.8rem;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        .form-group input, .form-group select {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 10px 12px;
            color: #fff;
            font-size: 0.95rem;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: rgba(102,126,234,0.6);
        }
        .form-group select option { background: #1e1e1e; }

        .readonly-field {
            background: rgba(102,126,234,0.1) !important;
            color: #81c784 !important;
        }

        .hint { font-size: 0.7rem; color: #666; margin-top: 3px; }

        .buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
        }
        .btn {
            flex: 1;
            padding: 14px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .btn-primary:hover { transform: scale(1.02); }
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .preview-section {
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 25px;
        }
        .preview-section h3 { margin-bottom: 20px; }

        /* ===== DOKUMENT PDF ===== */
        #document-container {
            background: #fff;
            padding: 60px;
            color: #000;
            font-family: 'Times New Roman', Times, serif;
            font-size: 14px;
            line-height: 1.6;
            width: 210mm;
            min-height: 297mm;
        }

        .doc-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 50px;
        }

        .doc-stamp {
            border: 2px dashed #888;
            padding: 15px 25px;
            text-align: center;
            min-width: 220px;
        }
        .doc-stamp-title {
            font-style: italic;
            color: #666;
            margin-bottom: 15px;
        }
        .doc-stamp-company { font-weight: bold; }
        .doc-stamp-address { font-size: 13px; margin-top: 5px; }
        .doc-stamp-nip { font-size: 12px; margin-top: 5px; }

        .doc-recipient { text-align: right; }
        .doc-recipient-label { margin-bottom: 5px; }
        .doc-recipient-name { font-weight: bold; font-size: 15px; }

        .doc-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin: 50px 0 15px 0;
            letter-spacing: 3px;
        }

        .doc-subtitle {
            text-align: center;
            margin-bottom: 40px;
        }

        .doc-intro { margin-bottom: 25px; }

        .doc-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        .doc-table th, .doc-table td {
            border: 1px solid #000;
            padding: 15px;
            vertical-align: top;
        }
        .doc-table th { background: #f5f5f5; font-weight: bold; }
        .doc-table .col-kwota {
            width: 130px;
            text-align: center;
            vertical-align: middle;
            font-size: 16px;
            font-weight: bold;
        }
        .doc-table .col-tresc { line-height: 1.8; }

        .doc-signatures {
            display: flex;
            justify-content: space-between;
            margin-top: 100px;
            padding: 0 50px;
        }
        .doc-signature {
            text-align: center;
            width: 200px;
        }
        .doc-signature-line {
            border-top: 1px solid #000;
            padding-top: 10px;
            margin-top: 80px;
            font-size: 13px;
        }
        .doc-signature-note {
            font-size: 10px;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 900px) {
            #document-container { width: 100%; padding: 30px; min-height: auto; }
            .form-row { grid-template-columns: 1fr; }
            .buttons { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Powr√≥t do listy skrypt√≥w</a>
        
        <header>
            <h1>üìÑ Generator Noty Ksiƒôgowej</h1>
            <p>Generuj noty ksiƒôgowe dla odszkodowa≈Ñ FedEx</p>
        </header>

        <!-- DANE NOTY -->
        <div class="form-card">
            <h2>üìã Dane noty</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Numer noty</label>
                    <input type="text" id="nota_numer" placeholder="np. NK/01/2026">
                </div>
                <div class="form-group">
                    <label>Data wystawienia</label>
                    <input type="date" id="nota_data">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Typ dokumentu</label>
                    <select id="nota_typ">
                        <option value="Orygina≈Ç">Orygina≈Ç</option>
                        <option value="Kopia">Kopia</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Rodzaj szkody</label>
                    <select id="szkoda_rodzaj">
                        <option value="uszkodzonƒÖ">uszkodzona przesy≈Çka</option>
                        <option value="zagubionƒÖ">zagubiona przesy≈Çka</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- DANE PRZESY≈ÅKI -->
        <div class="form-card">
            <h2>üì¶ Dane przesy≈Çki</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Numer przesy≈Çki</label>
                    <input type="text" id="przesylka_numer" placeholder="np. 794644790240">
                </div>
                <div class="form-group">
                    <label>Data nadania</label>
                    <input type="date" id="przesylka_data">
                </div>
            </div>
        </div>

        <!-- KWOTA -->
        <div class="form-card">
            <h2>üí∞ Kwota odszkodowania</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Kwota (PLN)</label>
                    <input type="number" id="kwota" step="0.01" placeholder="np. 1500.00" oninput="autoKwotaSlownie()">
                </div>
                <div class="form-group">
                    <label>Kwota s≈Çownie</label>
                    <input type="text" id="kwota_slownie" placeholder="uzupe≈Çni siƒô automatycznie">
                    <span class="hint">Mo≈ºesz te≈º wpisaƒá rƒôcznie</span>
                </div>
            </div>
        </div>

        <!-- DANE STA≈ÅE -->
        <div class="form-card">
            <h2>üè¢ Dane sta≈Çe (BL Paczka)</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>Nazwa firmy</label>
                    <input type="text" id="firma_nazwa" value="BL Logistics sp. z o.o." class="readonly-field" readonly>
                </div>
                <div class="form-group">
                    <label>NIP</label>
                    <input type="text" id="firma_nip" value="5213971463" class="readonly-field" readonly>
                </div>
            </div>
            <div class="form-row single">
                <div class="form-group">
                    <label>Adres</label>
                    <input type="text" id="firma_adres" value="ul. Czerska 8/10, 00-732 Warszawa" class="readonly-field" readonly>
                </div>
            </div>
            <div class="form-row single">
                <div class="form-group">
                    <label>Numer konta bankowego</label>
                    <input type="text" id="konto" value="48 1140 1140 0000 3902 8700 1033" class="readonly-field" readonly>
                </div>
            </div>
        </div>

        <div class="buttons">
            <button class="btn btn-secondary" onclick="resetForm()">üîÑ Wyczy≈õƒá</button>
            <button class="btn btn-primary" onclick="generatePDF()">üì• Generuj PDF</button>
        </div>

        <!-- PODGLƒÑD DOKUMENTU -->
        <div class="preview-section">
            <h3>üëÅÔ∏è PodglƒÖd dokumentu</h3>
            
            <div id="document-container">
                <div class="doc-header">
                    <div class="doc-stamp">
                        <div class="doc-stamp-title">(PieczƒÖtka firmowa wystawcy noty)</div>
                        <div class="doc-stamp-company" id="doc_firma">BL Logistics sp. z o.o.</div>
                        <div class="doc-stamp-address" id="doc_adres">ul. Czerska 8/10, 00-732 Warszawa</div>
                        <div class="doc-stamp-nip">NIP: <span id="doc_nip">5213971463</span></div>
                    </div>
                    <div class="doc-recipient">
                        <div class="doc-recipient-label">Adresat:</div>
                        <div class="doc-recipient-name">FedEx Express Poland</div>
                        <div>ul. Annopol 19</div>
                        <div>03-236 Warszawa</div>
                    </div>
                </div>

                <div class="doc-title">NOTA KSIƒòGOWA</div>
                <div class="doc-subtitle">
                    Nr <strong id="doc_numer">___</strong> z dnia <strong id="doc_data">___</strong><br>
                    <span id="doc_typ">Orygina≈Ç</span>
                </div>

                <p class="doc-intro">Prosimy o zgodne z nami zaksiƒôgowanie nastƒôpujƒÖcych pozycji:</p>

                <table class="doc-table">
                    <tr>
                        <th>ObciƒÖ≈ºyli≈õmy</th>
                        <th>TRE≈öƒÜ</th>
                    </tr>
                    <tr>
                        <td class="col-kwota"><span id="doc_kwota">___</span> z≈Ç</td>
                        <td class="col-tresc">
                            ObciƒÖ≈ºamy Pa≈Ñstwa kwotƒÖ <strong><span id="doc_kwota2">___</span> z≈Ç</strong>
                            (s≈Çownie: <em><span id="doc_slownie">___</span></em>)
                            z tytu≈Çu odszkodowania za <span id="doc_rodzaj">uszkodzonƒÖ</span> przesy≈Çkƒô
                            nr <strong><span id="doc_przesylka">___</span></strong>
                            z dnia <strong><span id="doc_przesylka_data">___</span></strong>.
                            <br><br>
                            Odszkodowanie prosimy przes≈Çaƒá na konto:<br>
                            <strong><span id="doc_konto">48 1140 1140 0000 3902 8700 1033</span></strong>
                        </td>
                    </tr>
                </table>

                <div class="doc-signatures">
                    <div class="doc-signature">
                        <div class="doc-signature-line">sporzƒÖdzajƒÖcy</div>
                        <div class="doc-signature-note">(podpis i pieczƒÖtka)</div>
                    </div>
                    <div class="doc-signature">
                        <div class="doc-signature-line">akceptujƒÖcy</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ustaw dzisiejszƒÖ datƒô
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('nota_data').value = today;
            updatePreview();
        });

        // Aktualizuj podglƒÖd przy zmianach
        document.querySelectorAll('input, select').forEach(el => {
            el.addEventListener('input', updatePreview);
            el.addEventListener('change', updatePreview);
        });

        function formatDate(dateStr) {
            if (!dateStr) return '___';
            const d = new Date(dateStr);
            return d.toLocaleDateString('pl-PL');
        }

        function updatePreview() {
            const get = id => document.getElementById(id).value || '___';
            
            document.getElementById('doc_firma').textContent = get('firma_nazwa');
            document.getElementById('doc_adres').textContent = get('firma_adres');
            document.getElementById('doc_nip').textContent = get('firma_nip');
            document.getElementById('doc_numer').textContent = get('nota_numer');
            document.getElementById('doc_data').textContent = formatDate(document.getElementById('nota_data').value);
            document.getElementById('doc_typ').textContent = get('nota_typ');
            document.getElementById('doc_kwota').textContent = get('kwota');
            document.getElementById('doc_kwota2').textContent = get('kwota');
            document.getElementById('doc_slownie').textContent = get('kwota_slownie');
            document.getElementById('doc_rodzaj').textContent = get('szkoda_rodzaj');
            document.getElementById('doc_przesylka').textContent = get('przesylka_numer');
            document.getElementById('doc_przesylka_data').textContent = formatDate(document.getElementById('przesylka_data').value);
            document.getElementById('doc_konto').textContent = get('konto');
        }

        function autoKwotaSlownie() {
            const kwota = parseFloat(document.getElementById('kwota').value);
            if (!isNaN(kwota) && kwota > 0) {
                document.getElementById('kwota_slownie').value = numberToWords(kwota);
            }
        }

        function numberToWords(num) {
            const jednosci = ['', 'jeden', 'dwa', 'trzy', 'cztery', 'piƒôƒá', 'sze≈õƒá', 'siedem', 'osiem', 'dziewiƒôƒá'];
            const nastki = ['dziesiƒôƒá', 'jedena≈õcie', 'dwana≈õcie', 'trzyna≈õcie', 'czterna≈õcie', 'piƒôtna≈õcie', 'szesna≈õcie', 'siedemna≈õcie', 'osiemna≈õcie', 'dziewiƒôtna≈õcie'];
            const dziesiatki = ['', 'dziesiƒôƒá', 'dwadzie≈õcia', 'trzydzie≈õci', 'czterdzie≈õci', 'piƒôƒádziesiƒÖt', 'sze≈õƒádziesiƒÖt', 'siedemdziesiƒÖt', 'osiemdziesiƒÖt', 'dziewiƒôƒádziesiƒÖt'];
            const setki = ['', 'sto', 'dwie≈õcie', 'trzysta', 'czterysta', 'piƒôƒáset', 'sze≈õƒáset', 'siedemset', 'osiemset', 'dziewiƒôƒáset'];

            const zlote = Math.floor(num);
            const grosze = Math.round((num - zlote) * 100);
            
            if (zlote === 0) return 'zero z≈Çotych ' + grosze.toString().padStart(2, '0') + '/100';

            let result = '';

            // TysiƒÖce
            if (zlote >= 1000) {
                const tys = Math.floor(zlote / 1000);
                if (tys === 1) result += 'tysiƒÖc ';
                else if (tys >= 2 && tys <= 4) result += jednosci[tys] + ' tysiƒÖce ';
                else result += jednosci[tys] + ' tysiƒôcy ';
            }

            // Setki
            const reszta = zlote % 1000;
            const s = Math.floor(reszta / 100);
            if (s > 0) result += setki[s] + ' ';

            // DziesiƒÖtki i jedno≈õci
            const dd = reszta % 100;
            if (dd >= 10 && dd <= 19) {
                result += nastki[dd - 10] + ' ';
            } else {
                const d = Math.floor(dd / 10);
                const j = dd % 10;
                if (d > 0) result += dziesiatki[d] + ' ';
                if (j > 0) result += jednosci[j] + ' ';
            }

            // Z≈Çotych
            const ost = zlote % 10;
            const przed = Math.floor((zlote % 100) / 10);
            if (zlote === 1) result += 'z≈Çoty';
            else if (przed !== 1 && ost >= 2 && ost <= 4) result += 'z≈Çote';
            else result += 'z≈Çotych';

            return result.trim() + ' ' + grosze.toString().padStart(2, '0') + '/100';
        }

        function resetForm() {
            document.getElementById('nota_numer').value = '';
            document.getElementById('nota_data').value = new Date().toISOString().split('T')[0];
            document.getElementById('nota_typ').selectedIndex = 0;
            document.getElementById('szkoda_rodzaj').selectedIndex = 0;
            document.getElementById('przesylka_numer').value = '';
            document.getElementById('przesylka_data').value = '';
            document.getElementById('kwota').value = '';
            document.getElementById('kwota_slownie').value = '';
            updatePreview();
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const element = document.getElementById('document-container');
            
            // Poka≈º loader
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚è≥ Generowanie...';
            btn.disabled = true;

            try {
                // Renderuj HTML do canvas
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    logging: false,
                    backgroundColor: '#ffffff'
                });

                // Utw√≥rz PDF
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                
                // Oblicz proporcje
                const imgWidth = pageWidth - 20; // 10mm margines z ka≈ºdej strony
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Dodaj obraz do PDF
                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                pdf.addImage(imgData, 'JPEG', 10, 10, imgWidth, imgHeight);

                // Nazwa pliku
                const numer = document.getElementById('nota_numer').value || 'nota';
                const data = document.getElementById('nota_data').value || new Date().toISOString().split('T')[0];
                const filename = `Nota_ksiegowa_${numer.replace(/\//g, '-')}_${data}.pdf`;

                // Zapisz
                pdf.save(filename);
            } catch (error) {
                console.error('B≈ÇƒÖd generowania PDF:', error);
                alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas generowania PDF. Spr√≥buj ponownie.');
            }

            // Przywr√≥ƒá przycisk
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    </script>
</body>
</html>
